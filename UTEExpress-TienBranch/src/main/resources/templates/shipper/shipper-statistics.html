<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shipper Order Statistics</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="container mt-5">
        <h2 class="text-center">Order Statistics for Shipper</h2>

        <!-- Shipper Info -->
        <div class="card my-4">
            <div class="card-body">
                <h5>Shipper Information</h5>
                <p><strong>Name:</strong> <span th:text="${shipper.name}"></span></p>
                <p><strong>Phone:</strong> <span th:text="${shipper.phone}"></span></p>
                <p><strong>Status:</strong> 
                    <span th:text="${shipper.statusShipper == 1 ? 'Busy' : 'Available'}"></span>
                </p>
            </div>
        </div>

        <!-- Order Statistics -->
        <div class="row">
            <div class="col-md-6">
                <canvas id="orderChart" width="400" height="400"></canvas>
            </div>
            <div class="col-md-6">
                <table class="table table-bordered">
                    <thead class="table-dark">
                        <tr>
                            <th>Order Type</th>
                            <th>Count</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Pending Orders</td>
                            <td th:text="${pendingOrdersCount}"></td>
                        </tr>
                        <tr>
                            <td>Delivered Orders</td>
                            <td th:text="${deliveredOrdersCount}"></td>
                        </tr>
                        <tr>
                            <td>Failed Orders</td>
                            <td th:text="${failedOrdersCount}"></td>
                        </tr>
                        <tr>
                            <td><strong>Total Orders</strong></td>
                            <td th:text="${totalOrders}"></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Order Details -->
        <div class="mt-4">
            <h4>Order Details</h4>
            <table class="table table-striped">
                <thead class="table-dark">
                    <tr>
                        <th>#</th>
                        <th>Order ID</th>
                        <th>Status</th>
                        <th>Destination</th>
                        <th>Source</th>
                        <th>Weight</th>
                        <th>Updated At</th>
                    </tr>
                </thead>
                <tbody>
                    <tr th:each="order, iterStat : ${orders}">
                        <td th:text="${iterStat.count}"></td>
                        <td th:text="${order.orderID}"></td>
                        <td th:text="${order.statusOrderID == 0 ? 'Pending' : 
                                      (order.statusOrderID == 7 ? 'Delivered' : 
                                      (order.statusOrderID == 8 ? 'Failed' : 'Other'))}">
                        </td>
                        <td th:text="${order.destCity}"></td>
                        <td th:text="${order.sourceCity}"></td>
                        <td th:text="${order.weight} + ' kg'"></td>
                        <td th:text="${#dates.format(order.dateUpdate, 'dd/MM/yyyy HH:mm')}"></td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const ctx = document.getElementById('orderChart').getContext('2d');
            const orderChart = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: ['Pending', 'Delivered', 'Failed'],
                    datasets: [{
                        label: '# of Orders',
                        data: [
                            /* Dữ liệu từ Thymeleaf */
                            $,{pendingOrdersCount},
                            $,{deliveredOrdersCount},
                            $,{failedOrdersCount}
                        ],
                        backgroundColor: ['#f39c12', '#2ecc71', '#e74c3c'],
                        borderColor: ['#f39c12', '#2ecc71', '#e74c3c'],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'top',
                        }
                    }
                }
            });
        });
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
